package com.example.demo.pingshi.jwt.j1;

/**
 *  @description 自制jwt
 *  @date  2022/5/14 01:20
 */

import io.jsonwebtoken.impl.TextCodec;

import javax.crypto.Mac;
import javax.crypto.spec.SecretKeySpec;
import java.nio.charset.StandardCharsets;
import java.util.Base64;

public class JwtMaker {
    //   SECRET KEY
    private final static String secret_key = "iotKey";

    private static String sha256_HMAC(String message, String secret) {
        String hash = "";
        try {
            Mac sha256_HMAC = Mac.getInstance("HmacSHA256");
            SecretKeySpec secret_key = new SecretKeySpec(secret.getBytes(), "HmacSHA256");
            sha256_HMAC.init(secret_key);
            byte[] bytes = sha256_HMAC.doFinal(message.getBytes());
            //看这里的源码，就是把base64url最后的结果里的=去掉就行了。用Base64.getUrlEncoder().encodeToString()也是行的，最后把=去了就行了
            return TextCodec.BASE64URL.encode(bytes);
        } catch (Exception e) {
            e.printStackTrace();
        }
        return hash;
    }

    public static void main(String[] args) throws Exception{
        //手动形成jwt
        String s="{\"alg\":\"HS256\",\"typ\":\"JWT\"}";
        String header = Base64.getUrlEncoder().encodeToString(s.getBytes(StandardCharsets.US_ASCII));
        System.out.println("header:"+header);

        String payload="eyJwYXNzd29yZCI6InN1cGVyX2FkbWluIiwiYXV0aCI6WyJWSUVXX1NFUlZFUl9JTkZPIiwiUkVTVCIsIkFETUlOX0NPTlNPTEUiLCJBRE1JTklTVEVSX1VTRVJTIiwiQURNSU5JU1RFUl9VU0VSX1NFTEYiLCJBRE1JTklTVEVSX1RFTkFOVFMiLCJBRE1JTklTVEVSX1RFTkFOVF9TRUxGIiwiQURNSU5JU1RFUl9TQ0hFRFVMRVMiLCJTQ0hFRFVMRV9DT01NQU5EUyJdLCJ1c2VyX25hbWUiOiJzdXBlcl9hZG1pbiIsInNjb3BlIjpbImFwcCJdLCJ0ZW5hbnRJZCI6MSwiZXhwIjoxNjUyNDk2MTIxLCJhdXRob3JpdGllcyI6WyI4NjovYXJlYXR5cGVzL2RlbGV0ZS8qIiwiNDE6L3RlY2hub2xvZ3kvdGVjaG5vbG9neS9kZWxldGUvKiIsIjM5Oi90ZWNobm9sb2d5L3RlY2hub2xvZ3kvY3JlYXRlIiwiMjc6L2RldmljZXMvdjIvZGV2aWNlcyIsIjQwOi90ZWNobm9sb2d5L3RlY2hub2xvZ3kvdXBkYXRlLyoiLCIxMDc6L2RlcHQvdXBkYXRlIiwiOTU6L3Byb2R1Y3Rpb24vdXBkYXRlL3Rhc2svKiIsIjI5Oi9kZXZpY2VzL3VwZGF0ZS8qIiwiODM6L2FyZWF0eXBlcy9jcmVhdGUiLCI3MDovZGV2aWNldHlwZXMvdXBkYXRlLyovY29tbWFuZHMvKiIsIjE5Oi9yb2xlL2Fzc2lnbi9wZXJtaXNzaW9ucyIsIjM0Oi9hc3NldHMvY3JlYXRlIiwiNzY6L2RldmljZXR5cGVzL2RlbGV0ZS8qL3N0YXR1c2VzLyoiLCI1ODovZGV2aWNldHlwZXMvY3JlYXRlIiwiNTk6L2RldmljZXR5cGVzL3YyL2RldmljZXR5cGVzIiwiNzk6L3RlY2hub2xvZ3kvdGVtcGxhdGVzIiwiMTAyOi9wcm9kdWN0aW9uL2Zvcm11bGEvKi9zcGxpdCIsIjIxOi9yb2xlL2RlbGV0ZSIsIjE2Oi91c2VyL2RlbGV0ZSIsIjYzOi9kZXZpY2V0eXBlcy9jcmVhdGUvKi9hdHRyaWJ1dGVzIiwiOTg6L3Byb2R1Y3Rpb24vdGFza3MyZm9ybXVsYS9tZXJnZSIsIjI4Oi9kZXZpY2VzL2NyZWF0ZSIsIjc0Oi9zdGF0dXNlcyIsIjExOi9yb2xlL2xpc3QiLCIxODovcm9sZS9hc3NpZ24vbWVudXMiLCIxMzovdXNlci9hc3NpZ24vcm9sZXMiLCIzMjovc2wvZ2F0ZXdheWxpc3QiLCI3NTovZGV2aWNldHlwZXMvdXBkYXRlLyovc3RhdHVzZXMvKiIsIjQ0Oi90ZWNobm9sb2d5L2Zvcm11bGEvY3JlYXRlIiwiNzM6L2RldmljZXR5cGVzL2NyZWF0ZS8qL3N0YXR1c2VzIiwiOTY6L3Byb2R1Y3Rpb24vZGVsZXRlL3Rhc2svKiIsIjU2Oi9hc3NldHR5cGVzL2RlbGV0ZS8qIiwiNjQ6L2RldmljZXR5cGVzLyovYXR0cmlidXRlcyIsIjQ2Oi90ZWNobm9sb2d5L2Zvcm11bGEvZGVsZXRlLyoiLCI2NjovZGV2aWNldHlwZXMvZGVsZXRlLyovYXR0cmlidXRlLyoiLCI5MzovcHJvZHVjdGlvbi9jcmVhdGUvdGFzayIsIjk5Oi9kZXZpY2VzLyovaW52b2NhdGlvbnMiLCIxNDovdXNlci9saXN0IiwiNTU6L2Fzc2V0dHlwZXMvdXBkYXRlLyoiLCIzMDovZGV2aWNlcy9kZWxldGUvKiIsIjEwNTovZGVwdC9jcmVhdGUiLCI4NTovYXJlYXR5cGVzL3VwZGF0ZS8qIiwiMzY6L2Fzc2V0cy9kZWxldGUvKiIsIjk0Oi9wcm9kdWN0aW9uL3Rhc2tzIiwiMjA6L3JvbGUvdXBkYXRlIiwiODg6L2FyZWFzL2NyZWF0ZSIsIjg0Oi9hcmVhdHlwZXMiLCIxMDovcm9sZS9jcmVhdGUiLCIxNTovdXNlci91cGRhdGUiLCI3ODovdGVjaG5vbG9neS9jcmVhdGUvdGVtcGxhdGUiLCIxMDE6L3Byb2R1Y3Rpb24vZm9ybXVsYXMiLCIxMDg6L2RlcHQvZGVsZXRlIiwiODk6L2FyZWFzIiwiODA6L3RlY2hub2xvZ3kvdXBkYXRlL3RlbXBsYXRlLyoiLCI2ODovZGV2aWNldHlwZXMvY3JlYXRlLyovY29tbWFuZHMiLCIzODovdGVjaG5vbG9neS90ZWNobm9sb2d5cyIsIjY1Oi9kZXZpY2V0eXBlcy91cGRhdGUvKi9hdHRyaWJ1dGUvKiIsIjgxOi90ZWNobm9sb2d5L2RlbGV0ZS90ZW1wbGF0ZS8qIiwiMzU6L2Fzc2V0cy91cGRhdGUvKiIsIjkxOi9hcmVhcy9kZWxldGUvKiIsIjQzOi90ZWNobm9sb2d5L2Zvcm11bGFzIiwiNjA6L2RldmljZXR5cGVzL3VwZGF0ZS8qIiwiNTM6L2Fzc2V0dHlwZXMvY3JlYXRlIiwiMjQ6L21lbnUvbGlzdCIsIjQ1Oi90ZWNobm9sb2d5L2Zvcm11bGEvdXBkYXRlLyoiLCI1MTovYXNzaWdubWVudHMvKi9lbmQiLCIxMDY6L2RlcHQvbGlzdCIsIjY5Oi9jb21tYW5kcyIsIjYxOi9kZXZpY2V0eXBlcy9kZWxldGUvKiIsIjIyOi9wZXJtaXNzaW9uL2xpc3QiLCI3MTovZGV2aWNldHlwZXMvZGVsZXRlLyovY29tbWFuZHMvKiIsIjkwOi9hcmVhcy91cGRhdGUvKiIsIjMxOi9hc3NpZ25tZW50cy9jcmVhdGUiLCIxMjovdXNlci9jcmVhdGUiLCIxNzovdXNlci9yZXNldC9wYXNzd29yZCIsIjU0Oi9hc3NldHR5cGVzIiwiMTAzOi9wcm9kdWN0aW9uL2Zvcm11bGEvZGV2aWNlQXNzaWdubWVudCJdLCJqdGkiOiI2MDk1YjMxYS0yYzk2LTRkZTktOTYxNy0yZWExMWRhNDc5MjciLCJjbGllbnRfaWQiOiJpb3Rfd2ViIn0";
        //System.out.println("payload:"+payload);
        String tt="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwYXNzd29yZCI6InN1cGVyX2FkbWluIiwiYXV0aCI6WyJWSUVXX1NFUlZFUl9JTkZPIiwiUkVTVCIsIkFETUlOX0NPTlNPTEUiLCJBRE1JTklTVEVSX1VTRVJTIiwiQURNSU5JU1RFUl9VU0VSX1NFTEYiLCJBRE1JTklTVEVSX1RFTkFOVFMiLCJBRE1JTklTVEVSX1RFTkFOVF9TRUxGIiwiQURNSU5JU1RFUl9TQ0hFRFVMRVMiLCJTQ0hFRFVMRV9DT01NQU5EUyJdLCJ1c2VyX25hbWUiOiJzdXBlcl9hZG1pbiIsInNjb3BlIjpbImFwcCJdLCJ0ZW5hbnRJZCI6MSwiZXhwIjoxNjUyNDk2MTIxLCJhdXRob3JpdGllcyI6WyI4NjovYXJlYXR5cGVzL2RlbGV0ZS8qIiwiNDE6L3RlY2hub2xvZ3kvdGVjaG5vbG9neS9kZWxldGUvKiIsIjM5Oi90ZWNobm9sb2d5L3RlY2hub2xvZ3kvY3JlYXRlIiwiMjc6L2RldmljZXMvdjIvZGV2aWNlcyIsIjQwOi90ZWNobm9sb2d5L3RlY2hub2xvZ3kvdXBkYXRlLyoiLCIxMDc6L2RlcHQvdXBkYXRlIiwiOTU6L3Byb2R1Y3Rpb24vdXBkYXRlL3Rhc2svKiIsIjI5Oi9kZXZpY2VzL3VwZGF0ZS8qIiwiODM6L2FyZWF0eXBlcy9jcmVhdGUiLCI3MDovZGV2aWNldHlwZXMvdXBkYXRlLyovY29tbWFuZHMvKiIsIjE5Oi9yb2xlL2Fzc2lnbi9wZXJtaXNzaW9ucyIsIjM0Oi9hc3NldHMvY3JlYXRlIiwiNzY6L2RldmljZXR5cGVzL2RlbGV0ZS8qL3N0YXR1c2VzLyoiLCI1ODovZGV2aWNldHlwZXMvY3JlYXRlIiwiNTk6L2RldmljZXR5cGVzL3YyL2RldmljZXR5cGVzIiwiNzk6L3RlY2hub2xvZ3kvdGVtcGxhdGVzIiwiMTAyOi9wcm9kdWN0aW9uL2Zvcm11bGEvKi9zcGxpdCIsIjIxOi9yb2xlL2RlbGV0ZSIsIjE2Oi91c2VyL2RlbGV0ZSIsIjYzOi9kZXZpY2V0eXBlcy9jcmVhdGUvKi9hdHRyaWJ1dGVzIiwiOTg6L3Byb2R1Y3Rpb24vdGFza3MyZm9ybXVsYS9tZXJnZSIsIjI4Oi9kZXZpY2VzL2NyZWF0ZSIsIjc0Oi9zdGF0dXNlcyIsIjExOi9yb2xlL2xpc3QiLCIxODovcm9sZS9hc3NpZ24vbWVudXMiLCIxMzovdXNlci9hc3NpZ24vcm9sZXMiLCIzMjovc2wvZ2F0ZXdheWxpc3QiLCI3NTovZGV2aWNldHlwZXMvdXBkYXRlLyovc3RhdHVzZXMvKiIsIjQ0Oi90ZWNobm9sb2d5L2Zvcm11bGEvY3JlYXRlIiwiNzM6L2RldmljZXR5cGVzL2NyZWF0ZS8qL3N0YXR1c2VzIiwiOTY6L3Byb2R1Y3Rpb24vZGVsZXRlL3Rhc2svKiIsIjU2Oi9hc3NldHR5cGVzL2RlbGV0ZS8qIiwiNjQ6L2RldmljZXR5cGVzLyovYXR0cmlidXRlcyIsIjQ2Oi90ZWNobm9sb2d5L2Zvcm11bGEvZGVsZXRlLyoiLCI2NjovZGV2aWNldHlwZXMvZGVsZXRlLyovYXR0cmlidXRlLyoiLCI5MzovcHJvZHVjdGlvbi9jcmVhdGUvdGFzayIsIjk5Oi9kZXZpY2VzLyovaW52b2NhdGlvbnMiLCIxNDovdXNlci9saXN0IiwiNTU6L2Fzc2V0dHlwZXMvdXBkYXRlLyoiLCIzMDovZGV2aWNlcy9kZWxldGUvKiIsIjEwNTovZGVwdC9jcmVhdGUiLCI4NTovYXJlYXR5cGVzL3VwZGF0ZS8qIiwiMzY6L2Fzc2V0cy9kZWxldGUvKiIsIjk0Oi9wcm9kdWN0aW9uL3Rhc2tzIiwiMjA6L3JvbGUvdXBkYXRlIiwiODg6L2FyZWFzL2NyZWF0ZSIsIjg0Oi9hcmVhdHlwZXMiLCIxMDovcm9sZS9jcmVhdGUiLCIxNTovdXNlci91cGRhdGUiLCI3ODovdGVjaG5vbG9neS9jcmVhdGUvdGVtcGxhdGUiLCIxMDE6L3Byb2R1Y3Rpb24vZm9ybXVsYXMiLCIxMDg6L2RlcHQvZGVsZXRlIiwiODk6L2FyZWFzIiwiODA6L3RlY2hub2xvZ3kvdXBkYXRlL3RlbXBsYXRlLyoiLCI2ODovZGV2aWNldHlwZXMvY3JlYXRlLyovY29tbWFuZHMiLCIzODovdGVjaG5vbG9neS90ZWNobm9sb2d5cyIsIjY1Oi9kZXZpY2V0eXBlcy91cGRhdGUvKi9hdHRyaWJ1dGUvKiIsIjgxOi90ZWNobm9sb2d5L2RlbGV0ZS90ZW1wbGF0ZS8qIiwiMzU6L2Fzc2V0cy91cGRhdGUvKiIsIjkxOi9hcmVhcy9kZWxldGUvKiIsIjQzOi90ZWNobm9sb2d5L2Zvcm11bGFzIiwiNjA6L2RldmljZXR5cGVzL3VwZGF0ZS8qIiwiNTM6L2Fzc2V0dHlwZXMvY3JlYXRlIiwiMjQ6L21lbnUvbGlzdCIsIjQ1Oi90ZWNobm9sb2d5L2Zvcm11bGEvdXBkYXRlLyoiLCI1MTovYXNzaWdubWVudHMvKi9lbmQiLCIxMDY6L2RlcHQvbGlzdCIsIjY5Oi9jb21tYW5kcyIsIjYxOi9kZXZpY2V0eXBlcy9kZWxldGUvKiIsIjIyOi9wZXJtaXNzaW9uL2xpc3QiLCI3MTovZGV2aWNldHlwZXMvZGVsZXRlLyovY29tbWFuZHMvKiIsIjkwOi9hcmVhcy91cGRhdGUvKiIsIjMxOi9hc3NpZ25tZW50cy9jcmVhdGUiLCIxMjovdXNlci9jcmVhdGUiLCIxNzovdXNlci9yZXNldC9wYXNzd29yZCIsIjU0Oi9hc3NldHR5cGVzIiwiMTAzOi9wcm9kdWN0aW9uL2Zvcm11bGEvZGV2aWNlQXNzaWdubWVudCJdLCJqdGkiOiI2MDk1YjMxYS0yYzk2LTRkZTktOTYxNy0yZWExMWRhNDc5MjciLCJjbGllbnRfaWQiOiJpb3Rfd2ViIn0";
        System.out.println("signature:"+sha256_HMAC(tt, secret_key));

    }
}
